# Travis file for running some basic set of testreport checks on each commit
language: python

services: 
 - docker

before_install:
  # Set up environment needed to run testreport code tests
  - docker pull mitgcm/testreport-images:fc11-base-20170715
  - docker pull mitgcm/testreport-images:centos
  - docker run  -v `pwd`:/MITgcm --name fc11-testreport -t -d mitgcm/testreport-images:fc11-base-20170715 /bin/bash
  - docker exec -i fc11-testreport rpm -vv --rebuilddb
  - docker exec -i fc11-testreport df -h
  - docker exec -i fc11-testreport ls -altr /MITgcm
  - docker exec -i fc11-testreport yum install python-pip
  - docker exec -i fc11-testreport yum install gcc-gfortran
  - docker exec -i fc11-testreport yum install python-argparse
  # set options for Travis script
  - echo `pwd`
  - export MITGCM_TROPT="-devel -of=../tools/build_options/linux_amd64_gfortran"
  - export MITGCM_DECMD="docker exec -i fc11-testreport bash -c"
  # get docker image for OpenAD
  - docker pull mitgcm/testreport-images:centos
  - docker run --rm -v `pwd`:/MITgcm -it --name centos-openad -d mitgcm/testreport-images:centos  /bin/bash

jobs:
  include:
    # test OpenAD test first during debugging of testing
    - stage: openad tests
      env:
      - MITGCM_EXP="global_ocean.90x40x15" MITGCM_PRECS="16"
      - MITGCM_TROPT="-oad -devel -of=../tools/build_options/linux_amd64_gfortran"
      - MITGCM_DECMD="docker exec -i centos-openad bash -c 'pwd; cd /root/OpenAD; export PATH=.:${PATH};source setenv.sh;\\'"
      script: . tools/ci/runtr.sh
